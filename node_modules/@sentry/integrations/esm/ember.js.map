{"version":3,"file":"ember.js","sourceRoot":"","sources":["../src/ember.ts"],"names":[],"mappings":";AACA,OAAO,EAAE,eAAe,EAAE,MAAM,eAAe,CAAC;AAEhD,YAAY;AACZ;IAeE;;OAEG;IACH,eAAmB,OAA6B;QAA7B,wBAAA,EAAA,YAA6B;QAjBhD;;WAEG;QACI,SAAI,GAAW,KAAK,CAAC,EAAE,CAAC;QAe7B,0CAA0C;QAC1C,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,KAAK,IAAI,eAAe,EAAO,CAAC,KAAK,CAAC;IAC9D,CAAC;IAED;;OAEG;IACI,yBAAS,GAAhB,UAAiB,CAAqC,EAAE,aAAwB;QAC9E,+BAA+B;QADjC,iBA2CC;QAxCC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YAChB,OAAO,CAAC,KAAK,CAAC,+CAA+C,CAAC,CAAC;YAC/D,OAAO;SACR;QAED,IAAM,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;QAEvC,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,UAAC,KAAY;YACjC,IAAI,aAAa,EAAE,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;gBACzC,aAAa,EAAE,CAAC,SAAS,CAAC,UAAA,KAAK;oBAC7B,KAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC;oBACrC,aAAa,EAAE,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;gBAC1C,CAAC,CAAC,CAAC;aACJ;YAED,IAAI,OAAO,UAAU,KAAK,UAAU,EAAE;gBACpC,UAAU,CAAC,IAAI,CAAC,KAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;aACrC;iBAAM,IAAI,KAAI,CAAC,MAAM,CAAC,OAAO,EAAE;gBAC9B,MAAM,KAAK,CAAC;aACb;QACH,CAAC,CAAC;QAEF,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CACjB,OAAO,EACP,UAAC,MAAW;YACV,IAAI,aAAa,EAAE,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;gBACzC,aAAa,EAAE,CAAC,SAAS,CAAC,UAAA,KAAK;oBAC7B,IAAI,MAAM,YAAY,KAAK,EAAE;wBAC3B,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,kCAAkC,CAAC,CAAC;wBAC9D,KAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC;wBACrC,aAAa,EAAE,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;qBAC1C;yBAAM;wBACL,KAAK,CAAC,QAAQ,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;wBACjC,KAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC;wBACrC,aAAa,EAAE,CAAC,cAAc,CAAC,kCAAkC,CAAC,CAAC;qBACpE;gBACH,CAAC,CAAC,CAAC;aACJ;QACH,CAAC,CACF,CAAC;IACJ,CAAC;IAED;;;OAGG;IACK,wCAAwB,GAAhC,UAAiC,KAAY;QAC3C,KAAK,CAAC,iBAAiB,CAAC,UAAC,KAAY;YACnC,IAAI,KAAK,CAAC,GAAG,EAAE;gBACb,IAAM,YAAY,GAAG,KAAK,CAAC,GAAG,CAAC,YAAY,IAAI,EAAE,CAAC;gBAClD,KAAK,CAAC,GAAG,wBACJ,KAAK,CAAC,GAAG,IACZ,YAAY,mBAAM,YAAY,GAAE,OAAO,KACxC,CAAC;aACH;YACD,OAAO,KAAK,CAAC;QACf,CAAC,CAAC,CAAC;IACL,CAAC;IAjFD;;OAEG;IACW,QAAE,GAAW,OAAO,CAAC;IA+ErC,YAAC;CAAA,AAvFD,IAuFC;SAvFY,KAAK","sourcesContent":["import { Event, EventProcessor, Hub, Integration, Scope } from '@sentry/types';\nimport { getGlobalObject } from '@sentry/utils';\n\n/** JSDoc */\nexport class Ember implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public name: string = Ember.id;\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'Ember';\n\n  /**\n   * @inheritDoc\n   */\n  private readonly _Ember: any; // tslint:disable-line:variable-name\n\n  /**\n   * @inheritDoc\n   */\n  public constructor(options: { Ember?: any } = {}) {\n    // tslint:disable-next-line: no-unsafe-any\n    this._Ember = options.Ember || getGlobalObject<any>().Ember;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(_: (callback: EventProcessor) => void, getCurrentHub: () => Hub): void {\n    // tslint:disable:no-unsafe-any\n\n    if (!this._Ember) {\n      console.error('EmberIntegration is missing an Ember instance');\n      return;\n    }\n\n    const oldOnError = this._Ember.onerror;\n\n    this._Ember.onerror = (error: Error): void => {\n      if (getCurrentHub().getIntegration(Ember)) {\n        getCurrentHub().withScope(scope => {\n          this._addIntegrationToSdkInfo(scope);\n          getCurrentHub().captureException(error);\n        });\n      }\n\n      if (typeof oldOnError === 'function') {\n        oldOnError.call(this._Ember, error);\n      } else if (this._Ember.testing) {\n        throw error;\n      }\n    };\n\n    this._Ember.RSVP.on(\n      'error',\n      (reason: any): void => {\n        if (getCurrentHub().getIntegration(Ember)) {\n          getCurrentHub().withScope(scope => {\n            if (reason instanceof Error) {\n              scope.setExtra('context', 'Unhandled Promise error detected');\n              this._addIntegrationToSdkInfo(scope);\n              getCurrentHub().captureException(reason);\n            } else {\n              scope.setExtra('reason', reason);\n              this._addIntegrationToSdkInfo(scope);\n              getCurrentHub().captureMessage('Unhandled Promise error detected');\n            }\n          });\n        }\n      },\n    );\n  }\n\n  /**\n   * Appends SDK integrations\n   * @param scope The scope currently used.\n   */\n  private _addIntegrationToSdkInfo(scope: Scope): void {\n    scope.addEventProcessor((event: Event) => {\n      if (event.sdk) {\n        const integrations = event.sdk.integrations || [];\n        event.sdk = {\n          ...event.sdk,\n          integrations: [...integrations, 'ember'],\n        };\n      }\n      return event;\n    });\n  }\n}\n"]}